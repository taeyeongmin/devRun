<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="promotion">
	<insert id="insertPromotion">
		insert into
			promotion
		values(
			#{promotionCode},
			#{name},
			#{startDate},
			#{endDate},
			#{sideNote},
			#{isRegular},
			#{banner},
			#{viewCount},
			#{memberNo},
			default,
			#{nickname}
		)
	</insert>
	
	<update id="insertProductPromotion">
		<foreach collection="list" item="item" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL">
		into
			product_promotion
		values
		(#{item.productCode},#{item.promotionCode})
		</foreach>
	</update>
	
	<select id="selectAllPromotionList" resultMap="promotionCollection">
		select
		    *
		from
			view_product_promotion
	</select>
	<select id="selectPromotionByPromotionCode" resultMap="promotionCollection">
		select
		    *
		from
			view_product_promotion
		where
			promotion_code = #{promotionCode}
	</select>
	<resultMap type="promotion" id="promotionCollection">
		<id column="promotion_code" property="promotionCode"/>
		<result column="name" property="name"/>
		<result column="start_date" property="startDate"/>
		<result column="end_date" property="endDate"/>
		<result column="side_note" property="sideNote"/>
		<result column="is_regular" property="isRegular"/>
		<result column="banner" property="banner"/>
		<result column="view_count" property="viewCount"/>
		<result column="memberNo" property="memberNo"/>
		<result column="nickname" property="nickname"/>
		<result column="enroll_date" property="enrollDate"/>
		<collection property="productList" ofType="product">
			<id column="product_code" property="productCode"/>
			<result column="product_name" property="name"/>
			<result column="product_name" property="name"/>
			<result column="price" property="price"/>
			<result column="thumbnail" property="thumbnail"/>
			<result column="status" property="status"/>
		</collection>
	</resultMap>
</mapper>
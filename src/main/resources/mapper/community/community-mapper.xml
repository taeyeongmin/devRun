<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="community">
  <!-- 컬럼 글쓰기 -->
  <insert id="insertColumn">
  	insert into
  		community
  	values(
  		seq_community_no.nextval,
  		#{memberNo},
  		1,
  		#{title},
  		#{content},
  		default,
  		default,
  		default,
  		default,
  		default,
  		#{thumbnail}
  	)
  </insert>
  
  <!-- 컬럼 리스트 조회 -->
  <select id="selectColumnList" resultType="community">
  	select
  		*
  	from
  		community
  	where
  		page_code = 1
  	order by
  		community_no desc
  </select>
  
  <!-- 베스트 컬럼리스트 조회 -->
  <select id="columnBestList" resultType="community">
  	select
  		*
  	from
  		community
  	order by
  		like_count desc
  </select>
  
  <!-- 자유게시판 글쓰기 -->
    <insert id="insertFreeboard">
  	insert into
  		community
  	values(
  		seq_community_no.nextval,
  		#{memberNo},
  		4,
  		#{title},
  		#{content},
  		default,
  		default,
  		default,
  		default,
  		#{hashtag},
  		#{thumbnail}
  	)
  </insert>
  
  <!-- 자유게시판 리스트 조회 -->
  <select id="selectFreeboardList" resultType="communityEntity">
	select
	    c.*,
	    (select nickname from member where member_no = c.member_no) nickname
	from
	    community c
	where
		page_code = 4
	order by
	    community_no desc
  </select>
  
  <!-- 자유게시판 총 게시물 수 -->
  <!-- select 태그의 resultType, 혹은 resultMap은 반드시 써준다. -->
  <!-- 기본형 int일때는 _int라는 alias를 mybatis에서 제공한다. -->
  <select id="selectFreeboardCount" resultType="_int">
  	select
  		count(*)
  	from
  		community
  	where
  		page_code = 4
  </select>
  
  <!-- 자유게시판 상세보기 -->
  <select id="selectOneFreeBoard" resultType="communityEntity">
	select
	    c.*,
	    (select nickname from member where member_no = c.member_no) nickname,
	    (select authority from authorities where member_no = c.member_no) authority
	from
	    community c
  	where
  		community_no = #{community_no}
  </select>
  
  <!-- 자유게시판 댓글 -->
  <select id="selectFreeboardCommentList" resultType="communityCommentEntity">
  	select
	    c.*,
	    (select nickname from member where member_no = c.member_no) nickname
	from
	    community_comment c
	where
	    community_no = #{communityNo}
	start with
	    comment_level = 1
	connect by
	    prior comment_no = comment_ref_no
	order siblings by
	    reg_date asc
  </select>
  
  <!-- 댓글 입력 -->
  <insert id="insertFreeboardComment">
  	insert into community_comment
  	values(
  		seq_community_comment_no.nextval,
  		#{memberNo},
  		<choose>
			<when test="commentRefNo eq 0">
				null,
			</when>
			<when test="commentRefNo ne 0">
				#{commentRefNo},
			</when>
  		</choose>
  		#{communityNo},
  		#{commentLevel},
  		#{content},
  		default
  	)
  </insert>
  
</mapper>
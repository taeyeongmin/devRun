<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">
	<insert id="insertProduct">
	insert into product
	values(
		#{productCode} || seq_product_no.nextval,
		#{name},
		#{price},
		sysdate,
		#{thumbnail},
		#{content},
		#{viewCount},
		#{status}
	)	
	
		<selectKey keyProperty="productCode" resultType="String" order="AFTER">
			SELECT
			   A.PRODUCT_CODE
			FROM (
			   SELECT
			      PRODUCT_CODE,
			      ROW_NUMBER() OVER(ORDER BY REG_DATE DESC) RN
			   FROM PRODUCT
			   ORDER BY REG_DATE DESC
			) A
			WHERE RN = 1
			
		</selectKey>
	</insert>
	
	<!-- 상품 분류 테이블 추가 -->
	<insert id="insertProductCategory">
		insert into
			product_category
		values(
			#{childCategoryCode},
			#{productCode}
		)
	
	<!-- 상품 상세 테이블 추가 -->			
	</insert>
	
		<insert id="insertProductDetail">
		insert into
			product_detail
		values(
			seq_product_detail_no.nextval,
			#{productCode},
			#{optionNo},
			#{optionContent},
			#{sku},
			#{quantity}
		)
				
	</insert>
	
	<!-- 합쳐진 상품 리스트   -->
	<select id="selectAllProductList" resultType="ProductExtends">
		select
		    p.thumbnail,
		    p.name,
		    pd.option_no,
		    pd.quantity,
		    p.status,
		    pc.child_category_code,
		    p.reg_date,
		    p.view_count
		    
		from
		    product p left join product_category pc
		        on p.product_code = pc.product_code
		    left join product_detail pd 
		        on pc.product_code = pd.product_code
		order by
			p.reg_date desc
	</select>

	<!-- 상품 게시물 수  -->
	<select id="selectTotalBoardCount" resultType="_int" >
		select
			count(*)
		from
			product p left join product_category pc
		        on p.product_code = pc.product_code
		    left join product_detail pd 
		        on pc.product_code = pd.product_code
	</select>



	<!--태영 끝-->
	
	
	
	<!-- 혜진 시작 -->
	<select id="selectProductListByProductCode" resultType="product">
		select
			*
		from
			product
		where
			product_code like '%'||#{searchCode}||'%'
	</select>
	<!-- 혜진 끝 -->
	
</mapper>



